<!DOCTYPE html>
<html lang="en">

<head>
	<meta charset="utf-8">
	<link rel="stylesheet" href="car.css">
</head>

<body>
	<button id="btn">创建表格</button>
	<button id="clear">清空购物车</button>
	<table>
		<thead>
			<tr>
				<th>
					<input type="checkbox" id="all">
				</th>
				<th>商品名称</th>
				<th>商品数量</th>
				<th>商品单价</th>
				<th>小计</th>
				<th>操作</th>
			</tr>
		</thead>
		<tbody id="tbody">
			<!-- <tr>
				<td>
					<input type="checkbox" >
				</td>
				<td>飞鸽牌自行车</td>
				<td>
					<button class="reduce">-</button>
					<input type="text" value="1" readonly>
					<button class="add">+</button>
				</td>
				<td>200</td>
				<td>200</td>
				<td><a href="javascript:" class="del">删除</a></td>
			</tr> -->

			<!-- <tr>
				<td>
					<input type="checkbox">
				</td>
				<td>iPhoneX</td>
				<td>
					<button class="reduce">-</button>
					<input type="text" value="1" readonly>
					<button class="add">+</button>
				</td>
				<td>8000</td>
				<td>8000</td>
				<td><a href="javascript:" class="del">删除</a></td>
			</tr>

			<tr>
				<td>
					<input type="checkbox">
				</td>
				<td>爱玛电动车</td>
				<td>
					<button class="reduce">-</button>
					<input type="text" value="2" readonly>
					<button class="add">+</button>
				</td>
				<td>2000</td>
				<td>4000</td>
				<td><a href="javascript:" class="del">删除</a></td>
			</tr>

			<tr>
				<td>
					<input type="checkbox">
				</td>
				<td>三陵老粗布</td>
				<td>
					<button class="reduce">-</button>
					<input type="text" value="4" readonly>
					<button class="add">+</button>
				</td>
				<td>100</td>
				<td>400</td>
				<td><a href="javascript:" class="del">删除</a></td>
			</tr> -->
		</tbody>
	</table>
	<p>总计：<span class="total">0</span></p>
</body>

<script type="text/template" id="tmp">
	{{ each products v i  }}
	<tr>
		<td>
			<input type="checkbox" >
		</td>
		<td>{{v.name}}</td>
		<td>
			<button class="reduce">-</button>
			<input  class="num" type="text" value="{{v.number}}" readonly>
			<button class="add">+</button>
		</td>
		<td  class="yuan">{{v.yuan}}</td>
		<td  class="sum">{{v.sum}}</td>
		<td><a href="javascript:" class="del">删除</a></td>
	</tr>
	{{/each}}
</script>


<script src="./jquery-1.12.4.js"></script>
<script src="./template-web.js"></script>
<script>

	$(function () {
		var data = {
			products: [{
				name: "飞鸽牌自行车",
				number: 1,
				yuan: 200,
				sum: 200,
			},
			{
				name: "大力",
				number: 1,
				yuan: 300,
				sum: 300,
			},
			{
				name: "电视",
				number: 1,
				yuan: 200,
				sum: 200,
			},
			{
				name: "洗衣机",
				number: 1,
				yuan: 2000,
				sum: 2000,
			}]
		}

		var total = 0;//记录总价
		//创建表格
		$('#btn').on('click', function () {
			$('#tbody').html(template('tmp', data));
		})




		//全选反选
		$('#all').click(function () {
			if ($('#tbody tr').length == 0) {
				alert('请点击创建表格！')
				return false;
				return;
			}
			var ret = $(this).prop("checked");
			$('#tbody input').prop("checked", ret);

			if(ret) {
				total = 0;
				getSum ();
			}else {
				$('.total').html(0);
			}
		})
		//表格动态生成使用事件代理
		$('#tbody').on('click', 'input', function () {
			var len = $("#tbody input:checked").length;
			if (len === data.products.length) {
				// 所有的都被选中了
				$('#all').prop("checked", true);
			} else {
				// 不满足所有的都被选中了
				$('#all').prop("checked", false);
			}
		})
		

		$('#tbody').on('click', '.del', function () {
			this.parentNode.parentNode
			
		})

		//计算总价
		function getSum () {
			$('#tbody tr').each(function (i,v) {  
				
				var ipt = v.querySelectorAll('input')[1];
				var yuan = v.querySelector('.yuan');
				var sum = v.querySelector('.sum');
				total += ipt.value * yuan.innerText
				
			})
			//更新总价
			$('.total').html(total);
		}
	})

</script>

</html>